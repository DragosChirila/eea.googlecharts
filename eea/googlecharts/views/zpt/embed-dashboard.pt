<html tal:define="inline view/isInline; vhash view/get_visualization_hash">
<head>
<tal:block tal:condition="python: not inline">
    <link href="++resource++eea.googlecharts.view.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" tal:condition="exists:here/jquery.js" src="jquery.js"></script>
    <script type="text/javascript" tal:condition="exists:here/++resource++plone.app.jquery.js" src="++resource++plone.app.jquery.js"></script>
    <script type="text/javascript" tal:condition="not:exists:here/jquery.js & not:exists:here/++resource++plone.app.jquery.js" src="++resource++eea.jquery.js"></script>
    <script type="text/javascript" src="++resource++jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="++resource++eea.googlecharts.chart.js"></script>
    <script type="text/javascript" src="++resource++eea.googlecharts.datatable.js"></script>
    <script type="text/javascript" src="++resource++eea.googlecharts.embed_common.js"></script>
    <script type="text/javascript" src="++resource++eea.googlecharts.embed_dashboard.js"></script>
    <script type="text/javascript" src="++resource++eea.googlecharts.custom_filters.js"></script>
</tal:block>

<style type="text/css">
    #googlechart_full > div > div {overflow:hidden ! important;}
    #googlechart_filters {margin-top:0px !important;}
    .googlechart_full > div > div {overflow:hidden ! important;}
    .googlechart_filters {margin-top:0px !important;}
    body {margin:0;}
    .iframe_body {overflow: hidden;}
</style>

<script type="text/javascript" tal:content="string:
    var googlechart_config_array_$vhash = [];
    ">
</script>

<script type="text/javascript" tal:content="string:
    var available_columns_$vhash = ${view/get_columns};
    var merged_rows_$vhash = ${view/get_rows};
    var baseurl_$vhash = '${view/context/absolute_url}';
    var qr_pos_$vhash = '${view/qr_position}';
    var qr_size_$vhash = '${view/qr_size}';
    var wm_pos_$vhash = '${view/wm_position}';
    var wm_path_$vhash = '${view/wm_path}';
    var main_title_$vhash = '${view/get_maintitle}';
    var isInline_$vhash = '$inline';">
</script>
<tal:block tal:define="charts view/get_charts;">
    <tal:block tal:repeat="chart charts">
        <script type="text/javascript"
            tal:define="dashboard python:view.get_dashboard_js(chart)"
            tal:content="string: googlechart_config_array_$vhash.push(['${chart/id}', ${chart/config}, ${chart/columns}, ${chart/filters}, ${chart/width}, ${chart/height}, ${chart/filterposition}, ${chart/options}, $dashboard]);"></script>
    </tal:block>
</tal:block>

<script type="text/javascript"
    tal:define="dashboard view/get_dashboard"
    tal:content="structure string:
        var dashboard_config_$vhash = ${dashboard};

        jQuery(document).ready(function($){
            var settings_$vhash = {
                googlechart_config_array : googlechart_config_array_$vhash,
                main_title : main_title_$vhash,
                dashboard_config : dashboard_config_$vhash,
                baseurl : baseurl_$vhash,
                qr_pos : qr_pos_$vhash,
                qr_size : qr_size_$vhash,
                wm_pos : wm_pos_$vhash,
                wm_path : wm_path_$vhash,
                merged_rows : merged_rows_$vhash,
                available_columns : available_columns_$vhash,
                vhash : '$vhash',
                isInline : isInline_$vhash
            };
            drawDashboardEmbed(settings_$vhash);
        });
        ">
</script>

<style type="text/css" tal:content="view/get_customstyle">
</style>

</head>
<body class="iframe_body">

    <div tal:attributes="id string:googlechart_dashboard_$vhash" class="embedded-dashboard googlechart_dashboard">
    </div>

    <a tal:condition="python:not inline" style="float:right"
       tal:attributes="href view/context/absolute_url"
       i18n:translate=""
       target="_top">Go to original visualization</a>
</body>

</html>